@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Identity
@using GoalGrower.Models
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation
@inject HttpClient Http

<nav>
    <NavLink href="/">Sign Out</NavLink>
    <NavLink href="/dashboard">
        <img src="images\logo.png" alt="Goal Grower Logo" width="500" height="500" />
    </NavLink>

    @if (isAuthenticated)
    {
        <a href="#" @onclick="Logout">Sign Out</a>
    }
    else
    {
        @* <NavLink href="/login">Login</NavLink>
        <NavLink href="/register">Register</NavLink> *@
    }
</nav>

@code {
    private bool isAuthenticated = false;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        isAuthenticated = authState.User.Identity?.IsAuthenticated ?? false;
    }

    private async Task Logout()
    {
        // Call server-side logout API
        await Http.PostAsync("api/auth/logout", null);

        // Force a reload to clear authentication state
        Navigation.NavigateTo("/login", forceLoad: true);
    }
}
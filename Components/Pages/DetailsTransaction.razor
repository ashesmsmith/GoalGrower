@page "/transactiondetails/{TransactionId:int}"
@layout MainLayout

@using GoalGrower.Data
@using GoalGrower.Models
@using Microsoft.EntityFrameworkCore

@inject AppDbContext _context

<PageTitle>Goal Grower - Transaction Details Page</PageTitle>

<h1>Transaction Details</h1>

@if (transaction == null)
{
    <p>Loading...</p>
}
else
{
    <div class="details-container">
        <p>Date: @transaction.TransactionDate</p>
        <p>Type: @transaction.TransactionType</p>
        <p>Amount: @transaction.TransactionAmount</p>
        <p>Description: @transaction.TransactionDescription</p>

        @if (transaction.Goal != null)
        {
            <p>Goal: @transaction.Goal.GoalName</p>
        }

        <div class="icon-container">
            <a class="edit-transaction-icon" href="/edittransaction/@transaction.TransactionId">
                <img src="/images/edit-icon.png" alt="edit icon" class="icon" />
            </a>
            <a class="delete-transaction-icon" href="/deletetransaction/@transaction.TransactionId">
                <img src="/images/delete-icon.png" alt="delete icon" class="icon" />
            </a>
        </div>
    </div>
}

@if (!string.IsNullOrEmpty(errorMessage))
{
    <p style="color:red">@errorMessage</p>
}

@code {
    [Parameter]
    public int TransactionId { get; set; }

    private TransactionModel? transaction;
    private string errorMessage = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            transaction = await _context.Transactions
            .Include(t => t.Goal)
            .FirstOrDefaultAsync(t => t.TransactionId == TransactionId);

            if (transaction == null)
            {
                errorMessage = "Transaction not found.";
            }
        }
        catch (Exception ex)
        {
            errorMessage = "Error loading transaction: " + ex.Message;
        }
    }
}